(function(c){if(c){c.ajax_upload=function(a,b){a=c(a);if(a.size()!=1){console.error("You passed ",a.size()," elements to ajax_upload at once");return false}return new g(a,b)};var h=function(){var a=0;return function(){return a++}}(),g=function(a,b){this.button=a;this.iframe=this.input=this.form=this.wrapper=null;this.submitting=this.disabled=false;this.settings={action:"upload.php",name:"userfile",data:{},onSubmit:function(){},onComplete:function(){},onSuccess:function(){},onError:function(){}};c.extend(this.settings,
b);this.create_wrapper();this.create_input();jQuery.browser.msie&&this.make_parent_opaque();this.create_iframe()};g.prototype={set_data:function(a){this.settings.data=a},disable:function(){this.disabled=true;this.submitting||this.input.attr("disabled",true)},enable:function(){this.disabled=false;this.input.attr("disabled",false)},create_wrapper:function(){var a=this.button,b;b=this.wrapper=c("<div></div>").insertAfter(a).append(a);setTimeout(function(){b.css({position:"relative",display:"block",overflow:"hidden",/*
height:a.outerHeight(true),*/width:a.outerWidth(true)})},1);var d=this;b.mousemove(function(e){d.input&&d.input.css({top:e.pageY-b.offset().top-5+"px",left:e.pageX-b.offset().left-170+"px"})})},create_input:function(){var a=this;this.input=c('<input type="file" />').attr("name",this.settings.name).css({position:"absolute",margin:0,padding:0,width:"220px",heigth:"10px",opacity:0}).change(function(){if(c(this).val()!=""){a.submitting=true;a.submit();a.submitting=false}}).appendTo(this.wrapper).hover(function(){a.button.addClass("hover")},
function(){a.button.removeClass("hover")});this.disabled&&this.input.attr("disabled",true)},create_iframe:function(){var a="iframe_au"+h();this.iframe=c('<iframe name="'+a+'"></iframe>').css("display","none").appendTo("body")},submit:function(){var a=this,b=this.settings,d=this.file_from_path(this.input.val());if(b.onSubmit.call(this,d,this.get_ext(d))===false)a.disabled&&this.input.attr("disabled",true);else{this.create_form();this.input.appendTo(this.form);this.form.submit();this.input.remove();
this.input=null;this.form.remove();this.form=null;this.submitting=false;this.create_input();var e=this.iframe;e.load(function(){var f=e.contents().find("body").html();b.onComplete.call(a,d,f);f=="success"?b.onSuccess.call(a,d):b.onError.call(a,d,f);setTimeout(function(){e.remove()},1)});this.create_iframe()}},create_form:function(){this.form=c('<form method="post" enctype="multipart/form-data"></form>').appendTo("body").attr({action:this.settings.action,target:this.iframe.attr("name")});for(var a in this.settings.data)c('<input type="hidden" />').appendTo(this.form).attr({name:a,
value:this.settings.data[a]})},file_from_path:function(a){var b=a.lastIndexOf("\\");if(b!==-1)return a.slice(b+1);return a},get_ext:function(a){var b=a.lastIndexOf(".");if(b!==-1)return a.slice(b+1);return""},make_parent_opaque:function(){this.button.add(this.button.parents()).each(function(){var a=c(this).css("backgroundColor"),b=c(this).css("backgroundImage");if(a!="transparent"||b!="none"){c(this).css("opacity",1);return false}})}}}})(jQuery);